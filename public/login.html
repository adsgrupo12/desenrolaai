<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Desenrola Aí - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-white shadow-sm">
        <div class="container d-flex align-items-center">
            <a class="navbar-brand text-success flex-grow-0" href="#">
                <strong>✅ Desenrola Aí</strong>
            </a>
    
            <!-- Campo de pesquisa -->
            <form class="d-flex flex-grow-1 mx-auto position-relative" style="max-width: 600px;">
                <input 
                    class="form-control rounded-pill ps-5"
                    type="search" 
                    placeholder="Pesquise serviços, prestadores..." 
                    aria-label="Search">
                <span class="position-absolute top-50 translate-middle-y" style="left: 20px;">
                    <i class="fas fa-search text-muted"></i>
                </span>
            </form>
    
            <div class="flex-grow-0">
                <form class="d-flex gap-2">
                    <a class="btn btn-outline-success" href="login.html">Fazer login</a>
                    <a class="btn btn-success" href="signup.html">Cadastre-se</a>
                </form>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row align-items-center justify-content-center">
            <div class="col-md-5 text-center">
                <img src="./img/worker.png" class="img-fluid rounded-circle" alt="Imagem login">
            </div>

            <div class="col-md-5">
                <h4 class="mb-4">Acesse sua conta e comece agora mesmo!</h4>
                <p>Conecte-se ao Desenrola Aí e tenha acesso a novas oportunidades.</p>

                <div id="alert-message" class="alert d-none"></div>

                <!-- Formulário de Login -->
                <form id="loginForm">
                    <div class="mb-3">
                        <input type="email" class="form-control" id="email" placeholder="E-mail *" autocomplete="username" required>
                    </div>

                    <div class="mb-3">
                        <input type="password" class="form-control" id="password" placeholder="Senha *" autocomplete="current-password" required>
                    </div>

                    <div class="mb-3">
                        <a href="#" class="text-muted">Esqueci minha senha / recuperar senha</a>
                    </div>

                    <button type="submit" id="login-button" class="btn btn-success w-100">Fazer login</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.getElementById("loginForm").addEventListener("submit", async function(event) {
        event.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const alertMessage = document.getElementById("alert-message");
        const loginButton = document.getElementById("login-button");

        alertMessage.classList.add("d-none");

        if (email === "" || password === "") {
            alertMessage.className = "alert alert-danger";
            alertMessage.innerText = "Usuário e senha são obrigatórios.";
            alertMessage.classList.remove("d-none");
            return;
        }

        loginButton.disabled = true;

        try {
            const response = await fetch("https://parseapi.back4app.com/parse/functions/login", {
                method: "POST",
                //TESTE-->

                /*headers: {
                    "Content-Type": "application/json",
                    "X-Parse-Application-Id": process.env.PARSE_APP_ID,
                    "X-Parse-REST-API-Key": process.env.PARSE_API_KEY
                }*/

                
                headers: {
                    "Content-Type": "application/json",
                    "X-Parse-Application-Id": "N1NHQ0pZoF6c9SW1rsb7R5fhhPv5lHYFV3PsuWUe",
                    "X-Parse-REST-API-Key": "AP4V9MLECbJZJcrBTPT9DXZ7be6OESA630S1f2Qr"
                },
                body: JSON.stringify({ username: email, password })
            });

            const result = await response.json();
            console.log("Resposta da API:", result);

            if (result.result && result.result.sessionToken) {
                localStorage.setItem("sessionToken", result.result.sessionToken);
                window.location.href = "home.html";
            } else {
                throw new Error("Resposta inesperada da API, sessionToken ausente.");
            }

            if (response.ok && result.result) {
                localStorage.setItem("sessionToken", result.result.sessionToken);
                localStorage.setItem("userId", result.result.objectId);
                localStorage.setItem("fullName", result.result.fullName);


                alertMessage.className = "alert alert-success";
                alertMessage.innerText = "Login realizado com sucesso!";
                alertMessage.classList.remove("d-none");

                setTimeout(() => {
                    window.location.href = "home.html"; // Redirecionamento
                }, 2000);

            } else {
                throw new Error(result.error || "Erro ao fazer login. Verifique suas credenciais.");
            }
        } catch (error) {
            console.error("Erro na requisição:", error);
            alertMessage.className = "alert alert-danger";
            alertMessage.innerText = error.message;
            alertMessage.classList.remove("d-none");
        } finally {
            loginButton.disabled = false;
        }
    });

    </script>

</body>
</html>
